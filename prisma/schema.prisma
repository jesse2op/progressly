generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String         @id @default(cuid())
  name             String?
  username         String?        @unique
  email            String?        @unique
  emailVerified    DateTime?
  image            String?
  password         String?
  role             String         @default("CLIENT")
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  clientProfile    ClientProfile?
  coachProfile     CoachProfile?
  receivedMessages Message[]      @relation("ReceivedMessages")
  sentMessages     Message[]      @relation("SentMessages")
}

model CoachProfile {
  id             String          @id @default(cuid())
  userId         String          @unique
  code           String?         @unique
  specialization String?
  clients        ClientProfile[]
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  mealPlans      MealPlan[]
  workouts       Workout[]
}

model ClientProfile {
  id                 String              @id @default(cuid())
  userId             String              @unique
  code               String?             @unique
  coachId            String?
  coach              CoachProfile?       @relation(fields: [coachId], references: [id])
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  progressLogs       ProgressLog[]
  workoutAssignments WorkoutAssignment[]
  mealAssignments    MealAssignment[]
}

model Workout {
  id          String              @id @default(cuid())
  coachId     String
  title       String
  description String?
  exercises   String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  coach       CoachProfile        @relation(fields: [coachId], references: [id])
  assignments WorkoutAssignment[]
}

model WorkoutAssignment {
  id        String        @id @default(cuid())
  workoutId String
  clientId  String
  date      DateTime
  completed Boolean       @default(false)
  feedback  String?
  client    ClientProfile @relation(fields: [clientId], references: [id])
  workout   Workout       @relation(fields: [workoutId], references: [id])
}

model MealPlan {
  id               String           @id @default(cuid())
  coachId          String
  title            String
  content          String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  coach            CoachProfile     @relation(fields: [coachId], references: [id])
  mealAssignments  MealAssignment[]
}

model MealAssignment {
  id             String        @id @default(cuid())
  mealPlanId     String?
  clientId       String
  date           DateTime
  completedMeals String?       // JSON array of meal IDs or names marked as done
  customContent  String?       // For athlete's own daily log/modifications
  client         ClientProfile @relation(fields: [clientId], references: [id])
  mealPlan       MealPlan?     @relation(fields: [mealPlanId], references: [id])
}

model ProgressLog {
  id       String        @id @default(cuid())
  clientId String
  date     DateTime      @default(now())
  weight   Float?
  notes    String?
  photos   String?
  client   ClientProfile @relation(fields: [clientId], references: [id])
}

model Message {
  id         String   @id @default(cuid())
  senderId   String
  receiverId String
  content    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
}
